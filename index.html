<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å°å°ç”Ÿæ€å­¦å®¶ï¼šé£Ÿç‰©é“¾è§‚å¯Ÿè®°å½•ç³»ç»Ÿï¼ˆäº‘ç«¯å®æ—¶ç‰ˆï¼‰</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Arial Rounded MT Bold','Segoe UI','Microsoft YaHei',sans-serif}
    :root{
      --primary:#4a6fa5;
      --secondary:#6bbf59;
      --accent:#ff9e4a;
      --light:#f5f7fa;
      --dark:#2c3e50;
      --shadow:0 4px 6px rgba(0,0,0,.1)
    }
    body{
      background:linear-gradient(135deg,#e0f7fa 0%,#bbdefb 100%);
      color:var(--dark);
      min-height:100vh;
      padding:20px
    }
    .container{max-width:1200px;margin:0 auto}
    header{
      text-align:center;
      margin-bottom:30px;
      padding:20px;
      background:#fff;
      border-radius:15px;
      box-shadow:var(--shadow)
    }
    h1{color:var(--primary);margin-bottom:10px;font-size:2.2rem}
    .subtitle{color:var(--dark);font-size:1.1rem}

    .tab-container{display:flex;justify-content:center;margin-bottom:30px}
    .tab{
      padding:12px 26px;
      background:#fff;
      border:none;
      border-radius:10px 10px 0 0;
      font-size:1.1rem;
      font-weight:bold;
      cursor:pointer;
      transition:.3s;
      box-shadow:var(--shadow);
      margin:0 5px
    }
    .tab.active{background:var(--primary);color:#fff}
    .tab-content{
      display:none;
      background:#fff;
      border-radius:15px;
      padding:24px;
      box-shadow:var(--shadow);
      min-height:480px
    }
    .tab-content.active{display:block}

    .form-title{
      color:var(--primary);
      margin-bottom:10px;
      display:flex;
      align-items:center;
      font-size:1.3rem
    }
    .form-title i{margin-right:10px;font-size:1.5rem}
    .instruction{
      text-align:center;
      margin-bottom:20px;
      font-size:1.05rem;
      color:var(--dark);
      background:var(--light);
      padding:12px;
      border-radius:10px
    }

    /* æ‹–æ‹½æ¨¡å—åŒº */
    .palette{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:14px;
      padding:10px;
      background:#e3f2fd;
      border-radius:12px;
      border:2px dashed #bbdefb
    }
    .palette.locked,
    .canvas.locked{
      pointer-events:none;
      opacity:.5
    }
    .block{
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid #d1d5db;
      box-shadow:var(--shadow);
      cursor:grab;
      user-select:none;
      font-size:0.95rem;
      display:inline-flex;
      align-items:center;
      gap:4px;
      white-space:nowrap
    }
    .block.species{
      background:#fef9c3;
      border-color:#facc15;
      font-weight:500
    }
    .block.arrow{
      background:#e0f2fe;
      border-color:#38bdf8;
      font-weight:700
    }

    .canvas{
      margin-top:8px;
      min-height:80px;
      padding:12px;
      border-radius:12px;
      border:2px dashed #9ca3af;
      background:#fffbea;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center
    }
    .canvas.empty::before{
      content:"æŠŠå°åŠ¨ç‰©å’Œç®­å¤´æ‹–åˆ°è¿™é‡Œï¼Œæ‹¼æˆä¸€æ¡â€œè°åƒè°â€çš„é£Ÿç‰©é“¾";
      color:#9ca3af;
      font-size:0.95rem
    }

    .controls{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px
    }
    button.btn{
      padding:8px 14px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:0.95rem;
      font-weight:bold;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:var(--shadow);
      color:#fff
    }
    button.btn-primary{background:var(--primary)}
    button.btn-secondary{background:#6b7280}
    button.btn-danger{background:#e74c3c}
    button.btn:disabled{
      opacity:.5;
      cursor:not-allowed;
      box-shadow:none
    }

    .current-chain{
      margin-top:10px;
      font-size:0.98rem
    }
    .current-chain span.value{font-weight:bold;color:#111827}
    .tip{font-size:0.9rem;color:#6b7280;margin-top:4px}

    /* æ•™å¸ˆç«¯ */
    .teacher-controls{
      display:flex;
      justify-content:flex-end;
      gap:12px;
      margin-bottom:16px
    }
    .teacher-btn{
      padding:8px 14px;
      border-radius:999px;
      border:none;
      font-size:0.95rem;
      font-weight:bold;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:var(--light);
      box-shadow:var(--shadow)
    }
    .teacher-btn.refresh{color:var(--primary)}
    .teacher-btn.clear{color:#e74c3c}

    .stats-container{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:16px;
      margin-bottom:18px
    }
    .stat-card{
      background:var(--light);
      border-radius:10px;
      padding:14px;
      text-align:center;
      box-shadow:var(--shadow)
    }
    .stat-title{font-size:0.95rem;color:#4b5563}
    .stat-value{
      font-size:1.8rem;
      font-weight:bold;
      color:var(--primary);
      margin:6px 0
    }

    .summary-box{
      background:#fff;
      border-radius:10px;
      padding:16px;
      box-shadow:var(--shadow)
    }
    .summary-title{
      font-size:1.1rem;
      color:var(--primary);
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:6px
    }
    .summary-list{
      margin-left:20px
    }
    .summary-list li{
      margin:4px 0;
      font-size:1rem
    }
    .no-data{
      text-align:center;
      padding:40px;
      color:#666;
      font-size:1.05rem
    }

    .toast-message{
      position:fixed;
      left:50%;
      top:12px;
      transform:translateX(-50%);
      padding:8px 16px;
      border-radius:999px;
      font-size:0.95rem;
      font-weight:bold;
      color:#155724;
      background:#d4edda;
      box-shadow:var(--shadow);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      z-index:1000
    }
    .toast-message.error{
      background:#f8d7da;
      color:#721c24
    }
    .toast-message.show{opacity:1}

    @media (max-width:768px){
      .stats-container{grid-template-columns:1fr}
      .tab{padding:10px 18px;font-size:1rem}
      .teacher-controls{justify-content:center}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-paw"></i> é£Ÿç‰©é“¾è§‚å¯Ÿè®°å½•ç³»ç»Ÿ</h1>
      <p class="subtitle">æ‹–ä¸€æ‹–ã€è¿ä¸€è¿ï¼Œçœ‹çœ‹å¤§å®¶æ‹¼å‡ºäº†å“ªäº›â€œè°åƒè°â€çš„é£Ÿç‰©é“¾</p>
    </header>

    <div class="tab-container">
      <button class="tab active" data-tab="student">å­¦ç”Ÿæ“ä½œ</button>
      <button class="tab" data-tab="teacher">æ•™å¸ˆå¤§å±</button>
    </div>

    <!-- å­¦ç”Ÿå¡«å†™ -->
    <div id="student" class="tab-content active">
      <div class="student-form">
        <h2 class="form-title"><i class="fas fa-seedling"></i> æ‹¼ä¸€æ‹¼ï¼šè°åƒè°ï¼Ÿ</h2>
        <div class="instruction">
          è¯·ä»ä¸‹é¢é€‰æ‹©å°åŠ¨ç‰©å’Œç®­å¤´ï¼Œæ‹–åˆ°é»„è‰²åŒºåŸŸï¼Œæ‹¼å‡ºä¸€æ¡å®Œæ•´çš„é£Ÿç‰©é“¾ï¼Œç„¶åç‚¹å‡»â€œæäº¤ç»™è€å¸ˆâ€ã€‚
        </div>

        <!-- æ¨¡å—åº“ -->
        <div class="palette" id="palette"></div>

        <!-- ç”»å¸ƒ -->
        <div class="canvas empty" id="canvas"></div>

        <!-- æŒ‰é’® -->
        <div class="controls">
          <button class="btn btn-secondary" id="undoBtn">
            <i class="fas fa-undo"></i> åé€€ä¸€æ­¥
          </button>
          <button class="btn btn-danger" id="clearBtn">
            <i class="fas fa-broom"></i> å…¨éƒ¨æ¸…ç©º
          </button>
          <button class="btn btn-primary" id="submitBtn">
            <i class="fas fa-paper-plane"></i> æäº¤ç»™è€å¸ˆ
          </button>
        </div>

        <div class="current-chain">
          ä½ å½“å‰çš„é£Ÿç‰©é“¾ï¼š<span class="value" id="currentChain">ï¼ˆè¿˜æ²¡æœ‰å“¦ï¼‰</span>
        </div>
        <div class="tip">
          å»ºè®®ï¼šä¸€æ¡é£Ÿç‰©é“¾ä¸€èˆ¬æœ‰ 3ï½4 ä¸ªç”Ÿç‰©ï¼Œæœ€å¤šä¸è¶…è¿‡ 5 ä¸ªã€‚          
        </div>
      </div>
    </div>

    <!-- æ•™å¸ˆæŸ¥çœ‹ -->
    <div id="teacher" class="tab-content">
      <div class="teacher-dashboard">
        <div class="teacher-controls">
          <button class="teacher-btn refresh" id="refresh-btn">
            <i class="fas fa-sync-alt"></i> åˆ·æ–°æ•°æ®
          </button>
          <button class="teacher-btn clear" id="clear-btn">
            <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ•°æ®
          </button>
        </div>

        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-title">æ€»æäº¤æ¡æ•°</div>
            <div class="stat-value" id="total-submissions">0</div>
            <div class="stat-desc">æ‰€æœ‰å­¦ç”Ÿæäº¤çš„è®°å½•</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ä¸åŒé£Ÿç‰©é“¾æ¡æ•°</div>
            <div class="stat-value" id="unique-chains">0</div>
            <div class="stat-desc">å»é‡åçš„ç­”æ¡ˆç§ç±»</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ä»Šæ—¥æäº¤</div>
            <div class="stat-value" id="today-submissions">0</div>
            <div class="stat-desc">ä»Šå¤©è¯¾å ‚å†…çš„è®°å½•</div>
          </div>
        </div>

        <div class="summary-box">
          <div class="summary-title">
            <i class="fas fa-list-ol"></i> å…¨ç­é£Ÿç‰©é“¾æ±‡æ€»
          </div>
          <ol class="summary-list" id="summaryList"></ol>
          <div class="no-data" id="noDataTip" style="display:none;">
            <i class="fas fa-clipboard-list" style="font-size:2.2rem;margin-bottom:10px;"></i>
            <p>è¿˜æ²¡æœ‰å­¦ç”Ÿæäº¤é£Ÿç‰©é“¾å“¦ï½</p>
            <p style="margin-top:8px;font-size:0.95rem;">ç­‰ä¸€ç­‰ï¼Œæˆ–è€…æé†’å¤§å®¶ç‚¹å‡»â€œæäº¤ç»™è€å¸ˆâ€ã€‚</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- é¡¶éƒ¨çŠ¶æ€æç¤º -->
  <div class="toast-message" id="toast"></div>

  <!-- Firebase + é€»è¾‘ -->
  <script type="module">
    /************ 1ï¼‰åˆå§‹åŒ– Firebaseï¼ˆæ²¿ç”¨ä½ å²©çŸ³ç³»ç»Ÿçš„å†™æ³•ï¼‰ ************/
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp,
      query, orderBy, onSnapshot, getDocs, deleteDoc, doc,
      enableIndexedDbPersistence
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // TODOï¼šæŠŠè¿™é‡Œæ›¿æ¢æˆä½ è‡ªå·± Firebase æ§åˆ¶å°é‡Œçš„é…ç½®ï¼ˆè·Ÿå²©çŸ³ç³»ç»Ÿé‚£ä»½ä¸€æ ·ï¼‰
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // å¯é€‰ï¼šç¦»çº¿ç¼“å­˜
    enableIndexedDbPersistence(db).catch(err=>{
      console.warn("IndexedDB æŒä¹…åŒ–ä¸å¯ç”¨ï¼š", err?.code || err);
    });

    // é£Ÿç‰©é“¾é›†åˆ
    const colRef = collection(db, "foodchains");

    /************ 2ï¼‰UIï¼šæ ‡ç­¾åˆ‡æ¢ ************/
    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    /************ 3ï¼‰å­¦ç”Ÿç«¯ï¼šæ‹–æ‹½æ¨¡å—åˆå§‹åŒ– ************/
    const speciesList = [
      "ğŸŒ³æ ‘æœ¨","ğŸºç‹¼","ğŸ¦Œé¹¿","ğŸè›‡","ğŸŒ±é’è‰","ğŸ›è™«å­","ğŸ¸é’è›™","ğŸ°å…”å­","ğŸ¦…è€é¹°"
    ];
    const arrowList = ["â†’","â†"];

    const paletteEl = document.getElementById("palette");
    const canvasEl = document.getElementById("canvas");
    const currentChainEl = document.getElementById("currentChain");

    const undoBtn = document.getElementById("undoBtn");
    const clearBtn = document.getElementById("clearBtn");
    const submitBtn = document.getElementById("submitBtn");
    const toastEl = document.getElementById("toast");

    let hasSubmitted = false; // æœ¬æœºä¸€æ¬¡æäº¤é”å®š

    function showToast(msg, type="success"){
      toastEl.textContent = msg;
      toastEl.classList.remove("error");
      if(type==="error") toastEl.classList.add("error");
      toastEl.classList.add("show");
      setTimeout(()=>toastEl.classList.remove("show"), 1600);
    }

    function createPaletteBlock(label, type){
      const div = document.createElement("div");
      div.className = `block ${type}`;
      div.textContent = label;
      div.draggable = true;
      div.dataset.type = type;

      if(type === "species"){
        const pureName = label.replace(/^[^\u4e00-\u9fa5]+/, ""); // å»æ‰å‰é¢çš„ emoji
        div.dataset.value = pureName;
      }else{
        div.dataset.value = label;
      }

      div.addEventListener("dragstart", e=>{
        const payload = {
          type,
          value: div.dataset.value,
          label
        };
        e.dataTransfer.setData("text/plain", JSON.stringify(payload));
      });

      return div;
    }

    function createCanvasBlock(type, value, label){
      const div = document.createElement("div");
      div.className = `block ${type}`;
      div.textContent = label;
      div.dataset.type = type;
      div.dataset.value = value;
      return div;
    }

    function updateCanvasEmptyState(){
      if(canvasEl.children.length === 0){
        canvasEl.classList.add("empty");
      }else{
        canvasEl.classList.remove("empty");
      }
    }

    function parseCanvasSpeciesSequence(){
      const arr = [];
      Array.from(canvasEl.children).forEach(child=>{
        if(child.dataset.type === "species"){
          arr.push(child.dataset.value);
        }
      });
      return arr;
    }

    function updateCurrentChainDisplay(){
      const seq = parseCanvasSpeciesSequence();
      if(seq.length === 0){
        currentChainEl.textContent = "ï¼ˆè¿˜æ²¡æœ‰å“¦ï¼‰";
      }else{
        currentChainEl.textContent = seq.join("â†’");
      }
    }

    function initPalette(){
      speciesList.forEach(s=>{
        paletteEl.appendChild(createPaletteBlock(s, "species"));
      });
      arrowList.forEach(a=>{
        paletteEl.appendChild(createPaletteBlock(a, "arrow"));
      });
    }

    function initCanvasDragDrop(){
      canvasEl.addEventListener("dragover", e=>e.preventDefault());
      canvasEl.addEventListener("drop", e=>{
        e.preventDefault();
        if(hasSubmitted){
          showToast("å·²ç»æäº¤è¿‡å•¦ï¼Œä¸èƒ½å†ä¿®æ”¹äº†ã€‚","error");
          return;
        }
        const text = e.dataTransfer.getData("text/plain");
        if(!text) return;
        let payload;
        try{ payload = JSON.parse(text); }catch{ return; }
        const node = createCanvasBlock(payload.type, payload.value, payload.label);
        canvasEl.appendChild(node);
        updateCanvasEmptyState();
        updateCurrentChainDisplay();
      });
    }

    undoBtn.addEventListener("click", ()=>{
      if(hasSubmitted) return;
      if(canvasEl.children.length > 0){
        canvasEl.removeChild(canvasEl.lastElementChild);
        updateCanvasEmptyState();
        updateCurrentChainDisplay();
      }
    });

    clearBtn.addEventListener("click", ()=>{
      if(hasSubmitted) return;
      canvasEl.innerHTML = "";
      updateCanvasEmptyState();
      updateCurrentChainDisplay();
    });

    function lockThisClient(){
      hasSubmitted = true;
      submitBtn.disabled = true;
      undoBtn.disabled = true;
      clearBtn.disabled = true;
      paletteEl.classList.add("locked");
      canvasEl.classList.add("locked");
    }

    submitBtn.addEventListener("click", async ()=>{
      if(hasSubmitted){
        showToast("å·²ç»æäº¤è¿‡å•¦ï¼Œç­‰è€å¸ˆä¸€èµ·çœ‹ç»“æœå§ï¼","error");
        return;
      }
      const seq = parseCanvasSpeciesSequence();
      if(seq.length < 2){
        showToast("è‡³å°‘è¦æœ‰ä¸¤ä¸ªç”Ÿç‰©æ‰èƒ½ç®—ä¸€æ¡é£Ÿç‰©é“¾å“¦ï½","error");
        return;
      }

      const now = new Date();
      const record = {
        chainArray: seq,
        chainStr: seq.join("â†’"),
        date: now.toLocaleDateString('zh-CN'),
        timestamp: serverTimestamp(),
        createdAt: serverTimestamp()
      };

      try{
        await addDoc(colRef, record);
        if(seq.length < 3 || seq.length > 5){
          showToast("å·²æäº¤ï¼šä¸‹æ¬¡å¯ä»¥è¯•è¯• 3ï½5 ä¸ªç”Ÿç‰©çš„é£Ÿç‰©é“¾ï½");
        }else{
          showToast("æäº¤æˆåŠŸï¼æœ¬ç»„ä¸èƒ½å†ä¿®æ”¹äº†ã€‚");
        }
        lockThisClient();
      }catch(err){
        console.error("æäº¤å¤±è´¥ï¼š", err);
        showToast("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è®©è€å¸ˆå¸®å¿™ï½","error");
      }
    });

    /************ 4ï¼‰æ•™å¸ˆç«¯ï¼šå®æ—¶è®¢é˜… + ç»Ÿè®¡æ±‡æ€» ************/
    const summaryListEl = document.getElementById("summaryList");
    const noDataTipEl = document.getElementById("noDataTip");
    const totalSubmissionsEl = document.getElementById("total-submissions");
    const uniqueChainsEl = document.getElementById("unique-chains");
    const todaySubmissionsEl = document.getElementById("today-submissions");
    const refreshBtn = document.getElementById("refresh-btn");
    const clearBtnTeacher = document.getElementById("clear-btn");

    const q = query(colRef, orderBy('timestamp','desc'));

    function computeSummary(records){
      const counter = {};
      records.forEach(r=>{
        const key = r.chainStr || (Array.isArray(r.chainArray) ? r.chainArray.join("â†’") : "");
        if(!key) return;
        if(!counter[key]) counter[key] = 0;
        counter[key] += 1;
      });
      const entries = Object.entries(counter).sort((a,b)=>b[1]-a[1]);
      return entries;
    }

    function getTodayCount(records){
      const today = new Date().toLocaleDateString('zh-CN');
      return records.filter(r => r.date === today).length;
    }

    function renderSummaryFromRecords(records){
      const entries = computeSummary(records);

      totalSubmissionsEl.textContent = records.length;
      uniqueChainsEl.textContent = entries.length;
      todaySubmissionsEl.textContent = getTodayCount(records);

      summaryListEl.innerHTML = "";
      if(entries.length === 0){
        noDataTipEl.style.display = "block";
        return;
      }else{
        noDataTipEl.style.display = "none";
      }

      entries.forEach(([chain,count])=>{
        const li = document.createElement("li");
        li.textContent = `${chain}ï¼ˆ${count}ï¼‰`;
        summaryListEl.appendChild(li);
      });
    }

    // å®æ—¶è®¢é˜…
    onSnapshot(q, snapshot=>{
      const records = snapshot.docs.map(d=>{
        const data = d.data();
        const t = data.timestamp?.toMillis ? data.timestamp.toMillis() : 0;
        return { id:d.id, ...data, timestamp:t };
      });
      renderSummaryFromRecords(records);
    }, err=>{
      console.error("å®æ—¶è®¢é˜…å¤±è´¥ï¼š", err);
      showToast("æ•™å¸ˆç«¯å®æ—¶æ•°æ®è®¢é˜…å¤±è´¥ï¼Œå¯å°è¯•ç‚¹å‡»åˆ·æ–°æŒ‰é’®","error");
    });

    // æ‰‹åŠ¨åˆ·æ–°
    refreshBtn.addEventListener("click", async ()=>{
      try{
        const snap = await getDocs(q);
        const records = snap.docs.map(d=>{
          const data = d.data();
          const t = data.timestamp?.toMillis ? data.timestamp.toMillis() : 0;
          return { id:d.id, ...data, timestamp:t };
        });
        renderSummaryFromRecords(records);
        showToast("æ•°æ®å·²åˆ·æ–°ï¼");
      }catch(err){
        console.error("åˆ·æ–°å¤±è´¥ï¼š", err);
        showToast("åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•","error");
      }
    });

    // æ¸…ç©ºæ•°æ®ï¼ˆè€å¸ˆç”¨ï¼‰
    clearBtnTeacher.addEventListener("click", async ()=>{
      if(!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é£Ÿç‰©é“¾è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼")) return;
      showToast("æ­£åœ¨æ¸…ç©ºæ•°æ®...");
      try{
        const snap = await getDocs(colRef);
        await Promise.all(
          snap.docs.map(docSnap => deleteDoc(doc(db, "foodchains", docSnap.id)))
        );
        showToast("æ‰€æœ‰è®°å½•å·²æ¸…ç©ºï¼");
      }catch(err){
        console.error("æ¸…ç©ºå¤±è´¥ï¼š", err);
        showToast("æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error");
      }
    });

    /************ 5ï¼‰å¯åŠ¨ï¼šåˆå§‹åŒ–å‰ç«¯ ************/
    initPalette();
    initCanvasDragDrop();
    updateCanvasEmptyState();
    updateCurrentChainDisplay();
  </script>
</body>
</html>
